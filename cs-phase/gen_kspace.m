% generate raw k-space data from TIA data
dirs = {'/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_104/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_105/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_107/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_109/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_113/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_114/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_115/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_116/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_117/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_118/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_119/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_120/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_121/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_124/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_125/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_127/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_129/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_131/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_134/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_136/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_137/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_138/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_139/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_141/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_142/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_146/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_148/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_101_150/PREVENT_150/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_151/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_153/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_156/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_158/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_162/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_166/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_169/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_171/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_173/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_177/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_180/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_181/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_182/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_187/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_190/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_191/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_192/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_193/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_195/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_197/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_151_200/PREVENT_198/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_001/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_002/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_003/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_005/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_009/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_014/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_015/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_017/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_018/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_020/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_021/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_022/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_026/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_031/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_032/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_033/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_035/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_038/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_041/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_042/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_043/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_044/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_045/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_046/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_047/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_1_50/PREVENT_048/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_202/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_203/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_204/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_205/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_206/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_207/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_211/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_212/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_215/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_219/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_220/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_222/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_223/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_224/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_225/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_228/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_233/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_236/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_237/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_238/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_239/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_240/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_241/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_243/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_245/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_246/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_247/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_201_250/PREVENT_250/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_051/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_053/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_055/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_056/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_058/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_059/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_060/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_061/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_063/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_065/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_066/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_067/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_070/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_073/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_075/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_076/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_077/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_078/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_079/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_082/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_087/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_088/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_089/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_090/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_093/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_096/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_097/study/QSM_SPGR_GE','/Volumes/LaCie/TIA_brooklyn/QSMpatients_51_100/PREVENT_099/study/QSM_SPGR_GE'};

for i = 1:length(dirs)
    cd(dirs{i});
    load('all.mat', 'mag');
    load('all.mat', 'ph');

    k = ifftshift(ifftshift(ifftshift(ifft(ifft(ifft(mag.*exp(1j*ph),[],1),[],2),[],3),1),2),3);
    k = single(k);
    save('kspace.mat','k','-v7.3');

    clear k mag ph
end


% generate raw k-space data from MS data
dirs = {'/Volumes/LaCie/MS/2015-11-25 RR-006/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2015-11-26 RR-001/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2015-12-04 RR-004/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2015-12-11 RR-008/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2015-12-15 RR-007/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-01-04 RR-009/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-01-14 RR-010/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-01-22 RR-012/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-01-28 RR-013/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-02-02 RR-015/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-02-10 RR-018/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-02-16 RR-019/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-02-19 RR-016/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-03-04 RR-020/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-03-10 RR-021/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-03-14 RR-032/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-03-22 RR-029/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-03-22 RR-030/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-05 RR-039/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-13 RR-034/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-18 RR-033/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-19 RR-031/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-19 RR-038/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-20 RR-035/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-04-29 RR-026/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-05-03 RR-036/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-05-10 RR-037/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-05-27 RR-042/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-05-30 RR-040/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-05-31 RR-047/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-01 RR-045/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-03 RR-041/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-03 RR-049/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-06 RR-018/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-07 RR-048/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-09 RR-044/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-20 RR-046/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-06-30 RR-057/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-05 RR-050/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-05 RR-060/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-06 RR-061/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-08 RR-051/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-08 RR-056/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-21 RR-058/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-26 RR-059/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-26 RR-062/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-07-29 RR-053/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-02 RR-066/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-02 RR-071/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-03 RR-055/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-04 RR-065/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-04 RR-067/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-05 RR-063/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-09 RR-064/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-10 RR-074/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-12 RR-073/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-23 RR-069/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-24 RR-076/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-08-25 RR-078/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-02 RR-077/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-06 RR-084/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-08 RR-083/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-09 RR-075/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-12 RR-080/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-12 RR-086/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-13 RR-079/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-13 RR-091/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-15 RR-088/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-15 RR-101/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-16 RR-090/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-20 RR-099/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-23 RR-085/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-27 RR-081/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-28 RR-018/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-29 RR-089/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-09-29 RR-110/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-05 RR-102/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-06 RR-096/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-11 RR-094/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-12 RR-092/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-12 RR-100/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-17 RR-093/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-18 RR-095/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-10-31 RR-106/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-02 RR-104/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-04 RR-105/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-07 RR-113/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-08 RR-116/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-10 RR-108/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-15 RR-114/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-17 RR-112/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-23 RR-117/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-11-29 RR-115/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-01 RR-126/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-05 RR-119/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-12 RR-120/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-13 RR-124/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-13 RR-128/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-16 RR-118/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2016-12-19 RR-125/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-03 RR-129/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-05 RR-136/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-10 RR-131/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-11 RR-130/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-16 RR-132/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-17 RR-133/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-19 RR-134/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-20 RR-135/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-01-23 RR-081/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-08 RR-092/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-15 RR-137/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-23 RR-139/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-24 RR-145/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-27 RR-142/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-27 RR-143/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-02-28 RR-140/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-02 RR-144/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-03 RR-138/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-08 RR-152/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-15 RR-151/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-23 RR-148/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-27 RR-146/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-27 RR-153/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-28 RR-150/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-30 RR-149/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-03-31 RR-147/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-04-19 RR-155/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-04-25 RR-154/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-04-25 RR-156/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-04-28 RR-157/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-01 RR-158/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-02 RR-159/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-02 RR-160/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-03 RR-162/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-09 RR-161/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-10 RR-164/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-11 RR-163/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-15 RR-166/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-17 RR-081/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-18 RR-169/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-05-19 RR-165/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-01 RR-168/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-01 RR-174/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-02 RR-167/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-02 RR-170/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-05 RR-176/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-06 RR-092/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-08 RR-175/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-12 RR-172/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-16 RR-173/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-06-29 RR-177/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-10 RR-181/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-12 RR-178/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-12 RR-179/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-13 RR-183/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-14 RR-145/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-20 RR-182/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-21 RR-184/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-27 RR-186/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-07-28 RR-187/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-02 RR-193/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-08 RR-190/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-09 RR-195/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-10 RR-191/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-11 RR-189/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-18 RR-188/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-24 RR-162/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-25 RR-158/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-28 RR-159/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-08-28 RR-194/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-09-13 RR-198/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-09-14 RR-196/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-09-28 RR-180/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-09-29 RR-197/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-09-29 RR-200/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-10-06 RR-176/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-03 RR-205/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-08 RR-207/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-09 RR-209/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-10 RR-145/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-16 RR-206/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-17 RR-208/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-22 RR-187/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-11-22 RR-210/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-12-07 RR-212/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-12-14 RR-162/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-12-15 RR-159/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-12-21 RR-213/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-12-22 RR-158/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2017-12-22 RR-194/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-09 RR-214/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-12 RR-217/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-17 RR-211/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-19 RR-176/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-19 RR-216/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-22 RR-218/QSM_SPGR_GE/src', '/Volumes/LaCie/MS/2018-01-26 RR-215/QSM_SPGR_GE/src'};
for i = 1:length(dirs)
    k = [];
    cd(dirs{i});
    for j = 1:8
        mag_name = ['mag',num2str(j),'.nii'];
        nii  = load_nii(mag_name);
        mag = single(nii.img);
        ph_name = ['ph',num2str(j),'.nii'];
        nii  = load_nii(ph_name);
        ph = single(nii.img);

        k0 = ifftshift(ifftn(mag.*exp(1j*ph)));
        k = cat(4,k,k0);
        k = single(k);
    end
    save('kspace.mat','k','-v7.3');

    clear k mag ph
end





% generate more higher quality 1mm kspace
path_mag='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3_6'
path_ph='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3_7'
path_out='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/center_new'
qsm_r2s_prisma(path_mag, path_ph, path_out);

path_mag='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3LEFT_13'
path_ph='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3LEFT_14'
path_out='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/left_new'
qsm_r2s_prisma(path_mag, path_ph, path_out);

path_mag='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3RIGHT_20'
path_ph='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3RIGHT_21'
path_out='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/right_new'
qsm_r2s_prisma(path_mag, path_ph, path_out);

path_mag='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3EXTENSION_27'
path_ph='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3EXTENSION_28'
path_out='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/extension_new'
qsm_r2s_prisma(path_mag, path_ph, path_out);

path_mag='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3FLEXION_34'
path_ph='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/swi_1mm_5TE_prisma4_r3FLEXION_35'
path_out='/Volumes/LaCie/COSMOS_3T/cosmos_prisma/flexion_new'
qsm_r2s_prisma(path_mag, path_ph, path_out);

path_mag='/Users/uqhsun8/DATA/Amir/scans/PD_ME-GRE_PISA_9ECH__REP1_MAG_PD_ME-GRE/DICOM/PD_ME-GRE_PISA_9ECH__REP1_MAG'
path_ph='/Users/uqhsun8/DATA/Amir/scans/PD_ME-GRE_PISA_9ECH__REP1_PHA_PD_ME-GRE/DICOM/PD_ME-GRE_PISA_9ECH__REP1_PHA'
path_out='/Users/uqhsun8/DATA/Amir/scans/'
qsm_r2s_prisma(path_mag, path_ph, path_out);



dirs = {'/Users/uqhsun8/DATA/Amir/scans/QSM_R2S_PRISMA/src','/Volumes/LaCie/FGATIR/sorted_dicoms/Hs/14903/QSM_1mm/QSM_SPGR_GE/src','/Volumes/LaCie/FGATIR/sorted_dicoms/Hs/14903/QSM_p75/QSM_SPGR_GE/src','/Volumes/LaCie/FGATIR/sorted_dicoms/B_A/14922/QSM_p75/QSM_SPGR_GE/src','/Volumes/LaCie/FGATIR/sorted_dicoms/Qmrims_025/14982/QSM_p75/QSM_SPGR_GE/src','/Volumes/LaCie/FGATIR/sorted_dicoms/Qmrims_022/14946/QSM_p75/QSM_SPGR_GE/src','/Volumes/LaCie/FGATIR/sorted_dicoms/Js/14902/QSM_1mm/QSM_SPGR_GE/src'};

dirs = {'/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_CENTER/QSM_SPGR_GE/src','/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_BACKWARD/QSM_SPGR_GE/src','/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_FORWARD/QSM_SPGR_GE/src','/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_LEFT/QSM_SPGR_GE/src','/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_RIGHT/QSM_SPGR_GE/src'};

dirs = {'/Volumes/LaCie/COSMOS_3T/cosmos_prisma/center_new/QSM_R2S_PRISMA/src','/Volumes/LaCie/COSMOS_3T/cosmos_prisma/extension_new/QSM_R2S_PRISMA/src','/Volumes/LaCie/COSMOS_3T/cosmos_prisma/flexion_new/QSM_R2S_PRISMA/src','/Volumes/LaCie/COSMOS_3T/cosmos_prisma/left_new/QSM_R2S_PRISMA/src','/Volumes/LaCie/COSMOS_3T/cosmos_prisma/right_new/QSM_R2S_PRISMA/src'};


for i = 1:length(dirs)
    k = [];
    cd(dirs{i});
    for j = 1:9
        mag_name = ['mag',num2str(j),'.nii'];
        if ~isfile(mag_name)
            break
        else
            nii  = load_nii(mag_name);
            mag = single(nii.img);
            ph_name = ['ph',num2str(j),'.nii'];
            nii  = load_nii(ph_name);
            ph = single(nii.img);

            k0 = ifftshift(ifftn(mag.*exp(1j*ph)));
            k = cat(4,k,k0);
            k = single(k);
        end
    end
    save('kspace.mat','k','-v7.3');

    clear k mag ph
end



for i = 1:length(dirs)
    cd(dirs{i});
    load('../all.mat','vox','TE','z_prjs','dicom_info');
    save('params.mat','vox','TE','z_prjs','dicom_info','-v7.3');

    clear vox TE z_prjs dicom_info
end



% MS lesions
Path: /Volumes/LaCie/MS/2016-09-28 RR-018/QSM_SPGR_GE/RESHARP/TFI_resharp_lambda2000_smvrad2.nii
Path: /Volumes/LaCie/MS/2016-08-05 RR-063/QSM_SPGR_GE/RESHARP/TFI_resharp_lambda2000_smvrad2.nii
Path: /Volumes/LaCie/MS/2017-02-27 RR-142/QSM_SPGR_GE/RESHARP/TFI_resharp_lambda2000_smvrad2.nii
Path: /Volumes/LaCie/MS/2016-01-28 RR-013/QSM_SPGR_GE/RESHARP/TFI_resharp_lambda2000_smvrad2.nii
Path: /Volumes/LaCie/MS/2017-11-17 RR-208/QSM_SPGR_GE/RESHARP/TFI_resharp_lambda2000_smvrad2.nii

dirs ={'/Volumes/LaCie/MS/2016-09-28 RR-018/QSM_SPGR_GE/', '/Volumes/LaCie/MS/2016-08-05 RR-063/QSM_SPGR_GE/', '/Volumes/LaCie/MS/2017-02-27 RR-142/QSM_SPGR_GE/', '/Volumes/LaCie/MS/2016-01-28 RR-013/QSM_SPGR_GE/', '/Volumes/LaCie/MS/2017-11-17 RR-208/QSM_SPGR_GE/'}


rsync -aR '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_CENTER/QSM_SPGR_GE/src/kspace.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_BACKWARD/QSM_SPGR_GE/src/kspace.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_FORWARD/QSM_SPGR_GE/src/kspace.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_LEFT/QSM_SPGR_GE/src/kspace.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_RIGHT/QSM_SPGR_GE/src/kspace.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/center_new/QSM_R2S_PRISMA/src/kspace.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/extension_new/QSM_R2S_PRISMA/src/kspace.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/flexion_new/QSM_R2S_PRISMA/src/kspace.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/left_new/QSM_R2S_PRISMA/src/kspace.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/right_new/QSM_R2S_PRISMA/src/kspace.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_CENTER/QSM_SPGR_GE/src/params.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_BACKWARD/QSM_SPGR_GE/src/params.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_FORWARD/QSM_SPGR_GE/src/params.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_LEFT/QSM_SPGR_GE/src/params.mat' '/Users/uqhsun8/DATA/5_orientations_1mm/QSM_SPGRE_RIGHT/QSM_SPGR_GE/src/params.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/center_new/QSM_R2S_PRISMA/src/params.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/extension_new/QSM_R2S_PRISMA/src/params.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/flexion_new/QSM_R2S_PRISMA/src/params.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/left_new/QSM_R2S_PRISMA/src/params.mat' '/Volumes/LaCie/COSMOS_3T/cosmos_prisma/right_new/QSM_R2S_PRISMA/src/params.mat' '/Volumes/LaCie/MS/2016-09-28 RR-018/QSM_SPGR_GE/src/kspace.mat'  '/Volumes/LaCie/MS/2016-08-05 RR-063/QSM_SPGR_GE/src/kspace.mat'  '/Volumes/LaCie/MS/2017-02-27 RR-142/QSM_SPGR_GE/src/kspace.mat'  '/Volumes/LaCie/MS/2016-01-28 RR-013/QSM_SPGR_GE/src/kspace.mat'  '/Volumes/LaCie/MS/2017-11-17 RR-208/QSM_SPGR_GE/src/kspace.mat' kspace_for_csqsm_testing


