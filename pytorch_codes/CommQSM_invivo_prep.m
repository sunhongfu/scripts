% create 35 different head orientations for each phantom
z_prjs_all = [];

load('/Volumes/LaCie/COSMOS_7T/01EG/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/01EG/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/01EG/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/01EG/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/01EG/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];

load('/Volumes/LaCie/COSMOS_7T/02SCOTT/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/02SCOTT/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/02SCOTT/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/02SCOTT/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/02SCOTT/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];

load('/Volumes/LaCie/COSMOS_7T/03JK/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/03JK/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/03JK/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/03JK/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/03JK/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];

load('/Volumes/LaCie/COSMOS_7T/04JG/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/04JG/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/04JG/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/04JG/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/04JG/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];

load('/Volumes/LaCie/COSMOS_7T/05SG/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/05SG/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/05SG/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/05SG/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/05SG/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];

load('/Volumes/LaCie/COSMOS_7T/06PS/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/06PS/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/06PS/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/06PS/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/06PS/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];

load('/Volumes/LaCie/COSMOS_7T/07JON/left/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/07JON/right/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/07JON/neutral/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/07JON/flexion/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];
load('/Volumes/LaCie/COSMOS_7T/07JON/extension/QSM_MEGE_7T/all_new.mat','z_prjs')
z_prjs_all = [z_prjs_all; z_prjs];


for i = 1:5:15000
    nii = load_nii(['/Volumes/LaCie/CommQSM/invivo/QSM_VIVO/' num2str(i), '-Phantom_NIFTI.nii']);
    img = single(nii.img);

    % generate D and Field
    vox = [1 1 1];
    for j = 1:size(z_prjs_all,1)
        [field, D, dipole, field_kspace] = forward_field_calc(img, vox, z_prjs_all(j,:));
        D = fftshift(D);
        field_kspace = fftshift(field_kspace);
        nii = make_nii(D, vox);
        save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/D_shift/D_shift_' num2str(i) '-' num2str(j) '.nii']);
        nii = make_nii(real(field_kspace), vox);
        save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field_kspace_shift/real_field_kspace_shift_' num2str(i) '-' num2str(j) '.nii']);
        nii = make_nii(imag(field_kspace), vox);
        save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field_kspace_shift/imag_field_kspace_shift_' num2str(i) '-' num2str(j) '.nii']);

        % field_kspace(1)
        % field_D_cat = cat(3,field,D);
        % field_dipole_cat = cat(3,field,dipole);

        %% save chi(img), field, D, field_D_cat as NIFTIs
        % nii = make_nii(img, vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/chi/chi_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(field, vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field/field_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(D, vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/D/D_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(dipole, vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/dipole/dipole_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(field_dipole_cat, vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field_dipole_cat/field_dipole_cat_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(field_D_cat, vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field_D_cat/field_D_cat_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(real(field_kspace), vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field_kspace/real_field_kspace_' num2str(i) '-' num2str(j) '.nii']);
        % nii = make_nii(imag(field_kspace), vox);
        % save_nii(nii,['/Volumes/LaCie/CommQSM/invivo/data_for_training/field_kspace/imag_field_kspace_' num2str(i) '-' num2str(j) '.nii']);
    end
end



% generate kspace field from single orientation
for i = 1:15000
    nii = load_nii(['/scratch/itee/uqygao10/QSM_NEW/QSM_VIVO/' num2str(i), '-Phantom_NIFTI.nii']);
    img = single(nii.img);

    % generate D and Field
    vox = [1 1 1];
    z_prjs = [0 0 1];
    [~, ~, ~, field_kspace] = forward_field_calc(img, vox, z_prjs);
    nii = make_nii(real(field_kspace), vox);
    save_nii(nii,['/scratch/itee/uqhsun8/CommQSM/invivo/field_kspace_single_orien/real_field_kspace-' num2str(i) '.nii']);
    nii = make_nii(imag(field_kspace), vox);
    save_nii(nii,['/scratch/itee/uqhsun8/CommQSM/invivo/field_kspace_single_orien/imag_field_kspace-' num2str(i) '.nii']);
end

