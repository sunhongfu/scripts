gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject5/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject4/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject3/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU2/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject8/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject6/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject11/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject7/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject10/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject9/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii.gz



gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject3/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU2/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject5/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject4/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject8/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject6/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject11/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject7/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject10/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject9/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii.gz



gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject3/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU2/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject5/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject4/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject8/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject6/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject11/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject7/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject10/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject9/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii.gz



% BRAVO
mkdir /Users/uqhsun8/DATA/MEBRAVO/group/

nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject3/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo1 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU2/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo2 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo3 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo4 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject5/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo5 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject4/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo6 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject8/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo7 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject6/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo8 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject11/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo9 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject7/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo10 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject10/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo11 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject9/recon_uncombined/QSM_BRAVO_UNCOMBINED/ants_trans_T1_to_MNI.nii');
bravo12 = double(nii.img);


bravo_ave = bravo1 + bravo2 + bravo3 + bravo4 + bravo5 + bravo6 + bravo7+ bravo8+ bravo9+ bravo10+ bravo11+ bravo12;
mask_ave = single(bravo1~=0) + single(bravo2~=0) + single(bravo3~=0) + single(bravo4~=0) + single(bravo5~=0) + single(bravo6~=0) +single(bravo7~=0) + single(bravo8~=0) + single(bravo9~=0) + single(bravo10~=0) + single(bravo11~=0) + single(bravo12~=0);
bravo_ave = bravo_ave.*mask_ave;
bravo_ave(isinf(bravo_ave)) = 0;
bravo_ave(isnan(bravo_ave)) = 0;

nii.img = double(bravo_ave);
save_untouch_nii(nii,'/Users/uqhsun8/DATA/MEBRAVO/group/bravo_ave.nii');




% R2* mapping

nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject3/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm1 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU2/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm2 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm3 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm4 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject5/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm5 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject4/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm6 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject8/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm7 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject6/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm8 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject11/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm9 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject7/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm10 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject10/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm11 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject9/recon_uncombined/QSM_BRAVO_UNCOMBINED/R2_adj_to_MNI.nii');
r2sm12 = double(nii.img);



r2sm_ave = r2sm1 + r2sm2 + r2sm3 + r2sm4 + r2sm5 + r2sm6 + r2sm7+ r2sm8+ r2sm9+ r2sm10+ r2sm11+ r2sm12;
mask_ave = single(r2sm1~=0) + single(r2sm2~=0) + single(r2sm3~=0) + single(r2sm4~=0) + single(r2sm5~=0) + single(r2sm6~=0) +single(r2sm7~=0) + single(r2sm8~=0) + single(r2sm9~=0) + single(r2sm10~=0) + single(r2sm11~=0) + single(r2sm12~=0);
r2sm_ave = r2sm_ave.*mask_ave;
r2sm_ave(isinf(r2sm_ave)) = 0;
r2sm_ave(isnan(r2sm_ave)) = 0;

nii.img = double(r2sm_ave);
save_untouch_nii(nii,'/Users/uqhsun8/DATA/MEBRAVO/group/r2sm_ave.nii');




% QSM

nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject3/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm1 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU2/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm2 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm3 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm4 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject5/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm5 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject4/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm6 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject8/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm7 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject6/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm8 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject11/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm9 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject7/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm10 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject10/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm11 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject9/recon_uncombined/QSM_BRAVO_UNCOMBINED/chi_iLSQR_smvrad2_adj_to_MNI.nii');
qsm12 = double(nii.img);


qsm_ave = qsm1 + qsm2 + qsm3 + qsm4 + qsm5 + qsm6 + qsm7+ qsm8+ qsm9+ qsm10+ qsm11+ qsm12;
mask_ave = single(qsm1~=0) + single(qsm2~=0) + single(qsm3~=0) + single(qsm4~=0) + single(qsm5~=0) + single(qsm6~=0) +single(qsm7~=0) + single(qsm8~=0) + single(qsm9~=0) + single(qsm10~=0) + single(qsm11~=0) + single(qsm12~=0);
qsm_ave = qsm_ave.*mask_ave;
qsm_ave(isinf(qsm_ave)) = 0;
qsm_ave(isnan(qsm_ave)) = 0;

nii.img = double(qsm_ave);
save_untouch_nii(nii,'/Users/uqhsun8/DATA/MEBRAVO/group/qsm_ave.nii');






%
% SEQ: SPGR
%


gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject3/Sub3/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject6/Sub5/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject7/Sub4/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/J_B/Devel_Hba_17109/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/A_A/HbaDevel_17100/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii.gz

gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject3/Sub3/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject6/Sub5/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject7/Sub4/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/J_B/Devel_Hba_17109/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/A_A/HbaDevel_17100/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii.gz

% QSM
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject3/Sub3/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii');
qsm1 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject6/Sub5/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii');
qsm2 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject7/Sub4/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii');
qsm3 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/J_B/Devel_Hba_17109/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii');
qsm4 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/A_A/HbaDevel_17100/QSM_SPGR_GE/chi_iLSQR_smvrad3_spgr2bravo_swapped_adj_to_MNI.nii');
qsm5 = double(nii.img);


qsm_ave = qsm1 + qsm2 + qsm3 + qsm4 + qsm5;
mask_ave = single(qsm1~=0) + single(qsm2~=0) + single(qsm3~=0) + single(qsm4~=0) + single(qsm5~=0);
qsm_ave = qsm_ave.*mask_ave;
qsm_ave(isinf(qsm_ave)) = 0;
qsm_ave(isnan(qsm_ave)) = 0;

nii.img = double(qsm_ave);
save_untouch_nii(nii,'/Users/uqhsun8/DATA/MEBRAVO/group/spgr_qsm_ave.nii');



% R2* map
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject3/Sub3/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii');
r2sm1 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject6/Sub5/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii');
r2sm2 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject7/Sub4/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii');
r2sm3 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject2/J_B/Devel_Hba_17109/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii');
r2sm4 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/HONGFU_PRODUCTION_1/Subject1/A_A/HbaDevel_17100/QSM_SPGR_GE/R2_spgr2bravo_swapped_adj_to_MNI.nii');
r2sm5 = double(nii.img);


r2sm_ave = r2sm1 + r2sm2 + r2sm3 + r2sm4 + r2sm5;
mask_ave = single(r2sm1~=0) + single(r2sm2~=0) + single(r2sm3~=0) + single(r2sm4~=0) + single(r2sm5~=0);
r2sm_ave = r2sm_ave.*mask_ave;
r2sm_ave(isinf(r2sm_ave)) = 0;
r2sm_ave(isnan(r2sm_ave)) = 0;

nii.img = double(r2sm_ave);
save_untouch_nii(nii,'/Users/uqhsun8/DATA/MEBRAVO/group/spgr_r2sm_ave.nii');



% SE-BRAVO

gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject2/J_B/Devel_Hba_17109/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject3/Sub3/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject6/Sub5/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject1/A_A/HbaDevel_17100/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii.gz
gunzip -f /Users/uqhsun8/DATA/MEBRAVO/Subject7/Sub4/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii.gz


nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject2/J_B/Devel_Hba_17109/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii');
bravo1 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject3/Sub3/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii');
bravo2 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject6/Sub5/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii');
bravo3 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject1/A_A/HbaDevel_17100/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii');
bravo4 = double(nii.img);
nii = load_untouch_nii('/Users/uqhsun8/DATA/MEBRAVO/Subject7/Sub4/SAG_FSPGR_BRAVO_0/se2me_to_mni.nii');
bravo5 = double(nii.img);

bravo_ave = bravo1 + bravo2 + bravo3 + bravo4 + bravo5;
mask_ave = single(bravo1~=0) + single(bravo2~=0) + single(bravo3~=0) + single(bravo4~=0) + single(bravo5~=0);
bravo_ave = bravo_ave.*mask_ave;
bravo_ave(isinf(bravo_ave)) = 0;
bravo_ave(isnan(bravo_ave)) = 0;

nii.img = double(bravo_ave);
save_untouch_nii(nii,'/Users/uqhsun8/DATA/MEBRAVO/group/se-bravo_ave.nii');


