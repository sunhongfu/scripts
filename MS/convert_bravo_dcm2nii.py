import os
from multiprocessing import Pool

# list of the MS subjects
# subject_list = ['2015-11-25 RR-006', '2016-05-03 RR-036', '2016-08-04 RR-065', '2016-09-29 RR-110', '2017-01-03 RR-129', '2017-03-31 RR-147', '2017-06-29 RR-177', '2017-10-06 RR-176', '2015-11-26 RR-001', '2016-05-10 RR-037', '2016-08-04 RR-067', '2016-10-05 RR-102', '2017-01-05 RR-136', '2017-04-19 RR-155', '2017-07-10 RR-181', '2017-11-03 RR-205', '2015-12-04 RR-004', '2016-05-27 RR-042', '2016-08-05 RR-063', '2016-10-06 RR-096', '2017-01-10 RR-131', '2017-04-25 RR-154', '2017-07-12 RR-178', '2017-11-08 RR-207', '2015-12-11 RR-008', '2016-05-30 RR-040', '2016-08-09 RR-064', '2016-10-11 RR-094', '2017-01-11 RR-130', '2017-04-25 RR-156', '2017-07-12 RR-179', '2017-11-09 RR-209', '2015-12-15 RR-007', '2016-05-31 RR-047', '2016-08-10 RR-074', '2016-10-12 RR-092', '2017-01-16 RR-132', '2017-04-28 RR-157', '2017-07-13 RR-183', '2017-11-10 RR-145', '2016-01-04 RR-009', '2016-06-01 RR-045', '2016-08-12 RR-073', '2016-10-12 RR-100', '2017-01-17 RR-133', '2017-05-01 RR-158', '2017-07-14 RR-145', '2017-11-16 RR-206', '2016-01-14 RR-010', '2016-06-03 RR-041', '2016-08-23 RR-069', '2016-10-17 RR-093', '2017-01-19 RR-134', '2017-05-02 RR-159', '2017-07-20 RR-182', '2017-11-17 RR-208', '2016-01-22 RR-012', '2016-06-03 RR-049', '2016-08-24 RR-076', '2016-10-18 RR-095', '2017-01-20 RR-135', '2017-05-02 RR-160', '2017-07-21 RR-184', '2017-11-22 RR-187', '2016-01-28 RR-013', '2016-06-06 RR-018', '2016-08-25 RR-078', '2016-10-31 RR-106', '2017-01-23 RR-081', '2017-05-03 RR-162', '2017-07-27 RR-186', '2017-11-22 RR-210', '2016-02-02 RR-015', '2016-06-07 RR-048', '2016-09-02 RR-077', '2016-11-02 RR-104', '2017-02-08 RR-092', '2017-05-09 RR-161', '2017-07-28 RR-187', '2017-12-07 RR-212', '2016-02-10 RR-018', '2016-06-09 RR-044', '2016-09-06 RR-084', '2016-11-04 RR-105', '2017-02-15 RR-137', '2017-05-10 RR-164', '2017-08-02 RR-193', '2017-12-14 RR-162', '2016-02-16 RR-019', '2016-06-20 RR-046', '2016-09-08 RR-083', '2016-11-07 RR-113', '2017-02-23 RR-139', '2017-05-11 RR-163', '2017-08-08 RR-190', '2017-12-15 RR-159', '2016-02-19 RR-016', '2016-06-30 RR-057', '2016-09-09 RR-075', '2016-11-08 RR-116', '2017-02-24 RR-145', '2017-05-15 RR-166', '2017-08-09 RR-195', '2017-12-21 RR-213', '2016-03-04 RR-020', '2016-07-05 RR-050', '2016-09-12 RR-080', '2016-11-10 RR-108', '2017-02-27 RR-142', '2017-05-17 RR-081', '2017-08-10 RR-191', '2017-12-22 RR-158', '2016-03-10 RR-021', '2016-07-05 RR-060', '2016-09-12 RR-086', '2016-11-15 RR-114', '2017-02-27 RR-143', '2017-05-18 RR-169', '2017-08-11 RR-189', '2017-12-22 RR-194', '2016-03-14 RR-032', '2016-07-06 RR-061', '2016-09-13 RR-079', '2016-11-17 RR-112', '2017-02-28 RR-140', '2017-05-19 RR-165', '2017-08-18 RR-188', '2018-01-09 RR-214', '2016-03-22 RR-029', '2016-07-08 RR-051', '2016-09-13 RR-091', '2016-11-23 RR-117', '2017-03-02 RR-144', '2017-06-01 RR-168', '2017-08-24 RR-162', '2018-01-12 RR-217', '2016-03-22 RR-030', '2016-07-08 RR-056', '2016-09-15 RR-088', '2016-11-29 RR-115', '2017-03-03 RR-138', '2017-06-01 RR-174', '2017-08-25 RR-158', '2018-01-17 RR-211', '2016-04-05 RR-039', '2016-07-21 RR-058', '2016-09-15 RR-101', '2016-12-01 RR-126', '2017-03-08 RR-152', '2017-06-02 RR-167', '2017-08-28 RR-159', '2018-01-19 RR-176', '2016-04-13 RR-034', '2016-07-26 RR-059', '2016-09-16 RR-090', '2016-12-05 RR-119', '2017-03-15 RR-151', '2017-06-02 RR-170', '2017-08-28 RR-194', '2018-01-19 RR-216', '2016-04-18 RR-033', '2016-07-26 RR-062', '2016-09-20 RR-099', '2016-12-12 RR-120', '2017-03-23 RR-148', '2017-06-05 RR-176', '2017-09-13 RR-198', '2018-01-22 RR-218', '2016-04-19 RR-031', '2016-07-29 RR-053', '2016-09-23 RR-085', '2016-12-13 RR-124', '2017-03-27 RR-146', '2017-06-06 RR-092', '2017-09-14 RR-196', '2018-01-26 RR-215', '2016-04-19 RR-038', '2016-08-02 RR-066', '2016-09-27 RR-081', '2016-12-13 RR-128', '2017-03-27 RR-153', '2017-06-08 RR-175', '2017-09-28 RR-180', '2016-04-20 RR-035', '2016-08-02 RR-071', '2016-09-28 RR-018', '2016-12-16 RR-118', '2017-03-28 RR-150', '2017-06-12 RR-172', '2017-09-29 RR-197', '2016-04-29 RR-026', '2016-08-03 RR-055', '2016-09-29 RR-089', '2016-12-19 RR-125', '2017-03-30 RR-149', '2017-06-16 RR-173', '2017-09-29 RR-200', ]

subject_list = ['2017-01-03 RR-129', '2017-03-31 RR-147', '2017-06-29 RR-177', '2017-10-06 RR-176', '2015-11-26 RR-001', '2016-05-10 RR-037', '2016-08-04 RR-067', '2016-10-05 RR-102', '2017-01-05 RR-136', '2017-04-19 RR-155', '2017-07-10 RR-181', '2017-11-03 RR-205', '2015-12-04 RR-004', '2016-05-27 RR-042', '2016-08-05 RR-063', '2016-10-06 RR-096', '2017-01-10 RR-131', '2017-04-25 RR-154', '2017-07-12 RR-178', '2017-11-08 RR-207', '2015-12-11 RR-008', '2016-05-30 RR-040', '2016-08-09 RR-064', '2016-10-11 RR-094', '2017-01-11 RR-130', '2017-04-25 RR-156', '2017-07-12 RR-179', '2017-11-09 RR-209', '2015-12-15 RR-007', '2016-05-31 RR-047', '2016-08-10 RR-074', '2016-10-12 RR-092', '2017-01-16 RR-132', '2017-04-28 RR-157', '2017-07-13 RR-183', '2017-11-10 RR-145', '2016-01-04 RR-009', '2016-06-01 RR-045', '2016-08-12 RR-073', '2016-10-12 RR-100', '2017-01-17 RR-133', '2017-05-01 RR-158', '2017-07-14 RR-145', '2017-11-16 RR-206', '2016-01-14 RR-010', '2016-06-03 RR-041', '2016-08-23 RR-069', '2016-10-17 RR-093', '2017-01-19 RR-134', '2017-05-02 RR-159', '2017-07-20 RR-182', '2017-11-17 RR-208', '2016-01-22 RR-012', '2016-06-03 RR-049', '2016-08-24 RR-076', '2016-10-18 RR-095', '2017-01-20 RR-135', '2017-05-02 RR-160', '2017-07-21 RR-184', '2017-11-22 RR-187', '2016-01-28 RR-013', '2016-06-06 RR-018', '2016-08-25 RR-078', '2016-10-31 RR-106', '2017-01-23 RR-081', '2017-05-03 RR-162', '2017-07-27 RR-186', '2017-11-22 RR-210', '2016-02-02 RR-015', '2016-06-07 RR-048', '2016-09-02 RR-077', '2016-11-02 RR-104', '2017-02-08 RR-092', '2017-05-09 RR-161', '2017-07-28 RR-187', '2017-12-07 RR-212', '2016-02-10 RR-018', '2016-06-09 RR-044', '2016-09-06 RR-084', '2016-11-04 RR-105', '2017-02-15 RR-137', '2017-05-10 RR-164', '2017-08-02 RR-193', '2017-12-14 RR-162', '2016-02-16 RR-019', '2016-06-20 RR-046', '2016-09-08 RR-083', '2016-11-07 RR-113', '2017-02-23 RR-139', '2017-05-11 RR-163', '2017-08-08 RR-190', '2017-12-15 RR-159', '2016-02-19 RR-016', '2016-06-30 RR-057', '2016-09-09 RR-075', '2016-11-08 RR-116', '2017-02-24 RR-145', '2017-05-15 RR-166', '2017-08-09 RR-195', '2017-12-21 RR-213', '2016-03-04 RR-020', '2016-07-05 RR-050', '2016-09-12 RR-080', '2016-11-10 RR-108', '2017-02-27 RR-142', '2017-05-17 RR-081', '2017-08-10 RR-191', '2017-12-22 RR-158', '2016-03-10 RR-021', '2016-07-05 RR-060', '2016-09-12 RR-086', '2016-11-15 RR-114', '2017-02-27 RR-143', '2017-05-18 RR-169', '2017-08-11 RR-189', '2017-12-22 RR-194', '2016-03-14 RR-032', '2016-07-06 RR-061', '2016-09-13 RR-079', '2016-11-17 RR-112', '2017-02-28 RR-140', '2017-05-19 RR-165', '2017-08-18 RR-188', '2018-01-09 RR-214', '2016-03-22 RR-029', '2016-07-08 RR-051', '2016-09-13 RR-091', '2016-11-23 RR-117', '2017-03-02 RR-144', '2017-06-01 RR-168', '2017-08-24 RR-162', '2018-01-12 RR-217', '2016-03-22 RR-030', '2016-07-08 RR-056', '2016-09-15 RR-088', '2016-11-29 RR-115', '2017-03-03 RR-138', '2017-06-01 RR-174', '2017-08-25 RR-158', '2018-01-17 RR-211', '2016-04-05 RR-039', '2016-07-21 RR-058', '2016-09-15 RR-101', '2016-12-01 RR-126', '2017-03-08 RR-152', '2017-06-02 RR-167', '2017-08-28 RR-159', '2018-01-19 RR-176', '2016-04-13 RR-034', '2016-07-26 RR-059', '2016-09-16 RR-090', '2016-12-05 RR-119', '2017-03-15 RR-151', '2017-06-02 RR-170', '2017-08-28 RR-194', '2018-01-19 RR-216', '2016-04-18 RR-033', '2016-07-26 RR-062', '2016-09-20 RR-099', '2016-12-12 RR-120', '2017-03-23 RR-148', '2017-06-05 RR-176', '2017-09-13 RR-198', '2018-01-22 RR-218', '2016-04-19 RR-031', '2016-07-29 RR-053', '2016-09-23 RR-085', '2016-12-13 RR-124', '2017-03-27 RR-146', '2017-06-06 RR-092', '2017-09-14 RR-196', '2018-01-26 RR-215', '2016-04-19 RR-038', '2016-08-02 RR-066', '2016-09-27 RR-081', '2016-12-13 RR-128', '2017-03-27 RR-153', '2017-06-08 RR-175', '2017-09-28 RR-180', '2016-04-20 RR-035', '2016-08-02 RR-071', '2016-09-28 RR-018', '2016-12-16 RR-118', '2017-03-28 RR-150', '2017-06-12 RR-172', '2017-09-29 RR-197', '2016-04-29 RR-026', '2016-08-03 RR-055', '2016-09-29 RR-089', '2016-12-19 RR-125', '2017-03-30 RR-149', '2017-06-16 RR-173', '2017-09-29 RR-200', ]

def flirt_reg(sub):	
	cmd = '/home/hongfu/apps/mricrogl_lx/dcm2niix ' + '-o \'/media/pikelab/Hongfu/MS/' + sub + '\' -f bravo' + ' \'/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/' + sub + '/SAG_FSPGR_BRAVO_0\''
	# os.system(cmd)

	'''
	dcm2niix -o '/media/pikelab/Hongfu/MS/2015-11-25 RR-006' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2015-11-25 RR-006/SAG_FSPGR_BRAVO_2'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-05-03 RR-036' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-05-03 RR-036/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2015-11-26 RR-001' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2015-11-26 RR-001/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-05-10 RR-037' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-05-10 RR-037/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-05 RR-039' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-05 RR-039/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-13 RR-034' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-13 RR-034/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-18 RR-033' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-18 RR-033/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-19 RR-031' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-19 RR-031/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-20 RR-035' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-20 RR-035/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-29 RR-026' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-29 RR-026/SAG_FSPGR_BRAVO_3'
	dcm2niix -o '/media/pikelab/Hongfu/MS/2016-04-19 RR-038' -f bravo '/media/pikelab/WQL/Wei_Projects/Domperidone/Domperidone_DICOM/2016-04-19 RR-038/SAG_FSPGR_BRAVO_3'
	'''

	cmd2 = '/usr/local/fsl/bin/flirt -in \'/media/pikelab/Hongfu/MS/' + sub + '/QSM_SPGR_GE/src/mag1.nii\' -ref \'/media/pikelab/Hongfu/MS/' + sub + '/bravo.nii\' -out \'/media/pikelab/Hongfu/MS/' + sub + '/mag2bravo.nii\' -omat \'/media/pikelab/Hongfu/MS/' + sub + '/mag2bravo.mat\' -bins 256 -cost corratio -searchrx -180 180 -searchry -180 180 -searchrz -180 180 -dof 12  -interp trilinear'
	print(cmd2)
	os.system(cmd2)

	cmd3 = '/usr/local/fsl/bin/flirt -in \'/media/pikelab/Hongfu/MS/' + sub + '/QSM_SPGR_GE/RESHARP/LN_resharp_tik_1e-3_tv_4e-4_2000_smvrad_2.nii\' -applyxfm -init \'/media/pikelab/Hongfu/MS/' + sub + '/mag2bravo.mat\' -out \'/media/pikelab/Hongfu/MS/' + sub + '/qsm2bravo_LN_resharp_tik_1e-3_tv_4e-4_2000_smvrad_2\' -paddingsize 0.0 -interp trilinear -ref \'/media/pikelab/Hongfu/MS/' + sub + '/bravo.nii\''
	print(cmd3)
	os.system(cmd3)

	cmd4 = '/usr/local/fsl/bin/flirt -in \'/media/pikelab/Hongfu/MS/' + sub + '/QSM_SPGR_GE/RESHARP/TFI_resharp_lambda2000_smvrad2.nii\' -applyxfm -init \'/media/pikelab/Hongfu/MS/' + sub + '/mag2bravo.mat\' -out \'/media/pikelab/Hongfu/MS/' + sub + '/qsm2bravo_TFI_resharp_lambda2000_smvrad2\' -paddingsize 0.0 -interp trilinear -ref \'/media/pikelab/Hongfu/MS/' + sub + '/bravo.nii\''
	print(cmd4)
	os.system(cmd4)


	cmd5 = '/usr/local/fsl/bin/flirt -in \'/media/pikelab/Hongfu/MS/' + sub + '/R2s_SPGR_GE/R2s.nii\' -applyxfm -init \'/media/pikelab/Hongfu/MS/' + sub + '/mag2bravo.mat\' -out \'/media/pikelab/Hongfu/MS/' + sub + '/r2s2bravo\' -paddingsize 0.0 -interp trilinear -ref \'/media/pikelab/Hongfu/MS/' + sub + '/bravo.nii\''
	print(cmd5)
	os.system(cmd5)



if __name__ == '__main__':
	pool = Pool()
	pool.map(flirt_reg, subject_list)